###############################################################################
# üìã FLUJO 7: CHATBOT CONVERSACIONAL
###############################################################################
#
# OBJETIVO: Probar chatbot para ver citas y reservar citas
#
# ESCENARIOS:
#   1. Conversaci√≥n inicial - Saludo
#   2. Ver citas existentes
#   3. Reservar nueva cita (flujo multi-paso)
#   4. Consultar horarios disponibles
#   5. Cancelar cita
#   6. Ayuda y despedida
#
###############################################################################

@baseUrl = http://localhost:8000/api/v1

###############################################################################
# 1. PREPARACI√ìN - LOGIN PACIENTE
###############################################################################

### 1.1. Login Paciente
# @name loginPaciente
POST {{baseUrl}}/auth/login/
Content-Type: application/json

{
  "correo": "paciente1@test.com",
  "password": "paciente123"
}

@pacienteToken = {{loginPaciente.response.body.token}}
@pacienteId = {{loginPaciente.response.body.usuario.id}}
@pacienteEmail = paciente1@test.com

###############################################################################
# 2. INICIO DE CONVERSACI√ìN - SALUDO
###############################################################################

### 2.1. Enviar saludo inicial
# @name saludoInicial
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "Hola",
  "session_id": "test-session-001",
  "correo_electronico": "{{pacienteEmail}}"
}

@sessionId = test-session-001

### 2.2. Saludo variante
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "Buenos d√≠as",
  "session_id": "{{sessionId}}",
  "correo_electronico": "{{pacienteEmail}}"
}

### 2.3. Saludo informal
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "Hola! ¬øQu√© tal?",
  "session_id": "{{sessionId}}",
  "correo_electronico": "{{pacienteEmail}}"
}

###############################################################################
# 3. PEDIR AYUDA
###############################################################################

### 3.1. Solicitar ayuda
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "ayuda",
  "session_id": "{{sessionId}}",
  "correo_electronico": "{{pacienteEmail}}"
}

### 3.2. Variante de ayuda
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "¬øQu√© puedes hacer?",
  "session_id": "{{sessionId}}",
  "correo_electronico": "{{pacienteEmail}}"
}

###############################################################################
# 4. VER CITAS EXISTENTES
###############################################################################

### 4.1. Solicitar ver citas
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "quiero ver mis citas",
  "session_id": "{{sessionId}}",
  "correo_electronico": "{{pacienteEmail}}"
}

### 4.2. Variante - mis consultas
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "mostrar mis consultas",
  "session_id": "{{sessionId}}",
  "correo_electronico": "{{pacienteEmail}}"
}

### 4.3. Variante - listar citas
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "lista de citas",
  "session_id": "{{sessionId}}",
  "correo_electronico": "{{pacienteEmail}}"
}

###############################################################################
# 5. CONSULTAR HORARIOS DISPONIBLES
###############################################################################

### 5.1. Solicitar horarios disponibles
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "¬øQu√© horarios tienen disponibles?",
  "session_id": "{{sessionId}}",
  "correo_electronico": "{{pacienteEmail}}"
}

### 5.2. Variante - disponibilidad
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "cu√°ndo hay disponibilidad",
  "session_id": "{{sessionId}}",
  "correo_electronico": "{{pacienteEmail}}"
}

###############################################################################
# 6. RESERVAR CITA - FLUJO COMPLETO
###############################################################################

### 6.1. PASO 1: Iniciar reserva de cita
# @name iniciarReserva
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "quiero reservar una cita",
  "session_id": "reserva-session-001",
  "correo_electronico": "{{pacienteEmail}}"
}

@reservaSessionId = reserva-session-001

### 6.2. PASO 2: Proporcionar fecha (ma√±ana)
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "ma√±ana",
  "session_id": "{{reservaSessionId}}",
  "correo_electronico": "{{pacienteEmail}}"
}

### 6.3. PASO 3: Seleccionar horario
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "1",
  "session_id": "{{reservaSessionId}}",
  "correo_electronico": "{{pacienteEmail}}"
}

### 6.4. PASO 4: Seleccionar tipo de consulta
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "1",
  "session_id": "{{reservaSessionId}}",
  "correo_electronico": "{{pacienteEmail}}"
}

### 6.5. PASO 5: Confirmar cita
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "s√≠",
  "session_id": "{{reservaSessionId}}",
  "correo_electronico": "{{pacienteEmail}}"
}

###############################################################################
# 7. RESERVAR CITA - FLUJO CON FECHA ESPEC√çFICA
###############################################################################

### 7.1. Iniciar nueva reserva
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "agendar cita",
  "session_id": "reserva-session-002",
  "correo_electronico": "{{pacienteEmail}}"
}

### 7.2. Proporcionar fecha espec√≠fica (DD/MM/YYYY)
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "05/11/2025",
  "session_id": "reserva-session-002",
  "correo_electronico": "{{pacienteEmail}}"
}

### 7.3. Seleccionar horario 2
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "2",
  "session_id": "reserva-session-002",
  "correo_electronico": "{{pacienteEmail}}"
}

### 7.4. Seleccionar tipo de consulta (control)
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "2",
  "session_id": "reserva-session-002",
  "correo_electronico": "{{pacienteEmail}}"
}

### 7.5. Confirmar
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "confirmar",
  "session_id": "reserva-session-002",
  "correo_electronico": "{{pacienteEmail}}"
}

###############################################################################
# 8. RESERVAR CITA - FLUJO CON PALABRAS NATURALES
###############################################################################

### 8.1. Iniciar reserva con "pasado ma√±ana"
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "reservar para pasado ma√±ana",
  "session_id": "reserva-session-003",
  "correo_electronico": "{{pacienteEmail}}"
}

### 8.2. Bot solicita horario - seleccionar 3
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "3",
  "session_id": "reserva-session-003",
  "correo_electronico": "{{pacienteEmail}}"
}

### 8.3. Seleccionar tipo urgencia
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "3",
  "session_id": "reserva-session-003",
  "correo_electronico": "{{pacienteEmail}}"
}

### 8.4. Confirmar cita
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "s√≠, confirmo",
  "session_id": "reserva-session-003",
  "correo_electronico": "{{pacienteEmail}}"
}

###############################################################################
# 9. CANCELAR RESERVA EN PROGRESO
###############################################################################

### 9.1. Iniciar reserva
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "quiero una cita",
  "session_id": "cancelar-session-001",
  "correo_electronico": "{{pacienteEmail}}"
}

### 9.2. Cancelar durante el proceso
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "no",
  "session_id": "cancelar-session-001",
  "correo_electronico": "{{pacienteEmail}}"
}

### 9.3. Verificar que se cancel√≥
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "ayuda",
  "session_id": "cancelar-session-001",
  "correo_electronico": "{{pacienteEmail}}"
}

###############################################################################
# 10. CANCELAR CITA EXISTENTE
###############################################################################

### 10.1. Solicitar cancelar cita
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "quiero cancelar una cita",
  "session_id": "{{sessionId}}",
  "correo_electronico": "{{pacienteEmail}}"
}

### 10.2. Variante - eliminar cita
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "eliminar mi consulta",
  "session_id": "{{sessionId}}",
  "correo_electronico": "{{pacienteEmail}}"
}

###############################################################################
# 11. VER HISTORIAL DE CONVERSACI√ìN
###############################################################################

### 11.1. Obtener historial de la sesi√≥n principal
GET {{baseUrl}}/chatbot/historial/?session_id={{sessionId}}

### 11.2. Obtener historial de sesi√≥n de reserva
GET {{baseUrl}}/chatbot/historial/?session_id={{reservaSessionId}}

### 11.3. Obtener historial de sesi√≥n cancelada
GET {{baseUrl}}/chatbot/historial/?session_id=cancelar-session-001

###############################################################################
# 12. RESET DE CONVERSACI√ìN
###############################################################################

### 12.1. Resetear contexto de sesi√≥n principal
POST {{baseUrl}}/chatbot/reset/
Content-Type: application/json

{
  "session_id": "{{sessionId}}"
}

### 12.2. Verificar que contexto se limpi√≥
GET {{baseUrl}}/chatbot/historial/?session_id={{sessionId}}

### 12.3. Enviar mensaje despu√©s de reset
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "Hola de nuevo",
  "session_id": "{{sessionId}}",
  "correo_electronico": "{{pacienteEmail}}"
}

###############################################################################
# 13. DESPEDIDA
###############################################################################

### 13.1. Despedirse del bot
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "adi√≥s",
  "session_id": "{{sessionId}}",
  "correo_electronico": "{{pacienteEmail}}"
}

### 13.2. Variante - chao
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "chao, gracias",
  "session_id": "{{sessionId}}",
  "correo_electronico": "{{pacienteEmail}}"
}

### 13.3. Variante - hasta luego
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "hasta luego",
  "session_id": "{{sessionId}}",
  "correo_electronico": "{{pacienteEmail}}"
}

###############################################################################
# 14. EDGE CASES
###############################################################################

### 14.1. Mensaje sin sentido
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "asdfghjkl",
  "session_id": "edge-case-session",
  "correo_electronico": "{{pacienteEmail}}"
}

### 14.2. Mensaje vac√≠o
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "",
  "session_id": "edge-case-session",
  "correo_electronico": "{{pacienteEmail}}"
}

### 14.3. Fecha inv√°lida en reserva
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "quiero cita",
  "session_id": "fecha-invalida-session",
  "correo_electronico": "{{pacienteEmail}}"
}

### 14.4. Proporcionar fecha pasada
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "01/01/2020",
  "session_id": "fecha-invalida-session",
  "correo_electronico": "{{pacienteEmail}}"
}

### 14.5. Seleccionar horario inexistente
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "agendar cita",
  "session_id": "horario-invalido-session",
  "correo_electronico": "{{pacienteEmail}}"
}

### 14.6. Fecha v√°lida
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "ma√±ana",
  "session_id": "horario-invalido-session",
  "correo_electronico": "{{pacienteEmail}}"
}

### 14.7. N√∫mero de horario inv√°lido
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "999",
  "session_id": "horario-invalido-session",
  "correo_electronico": "{{pacienteEmail}}"
}

###############################################################################
# 15. USUARIO NO REGISTRADO
###############################################################################

### 15.1. Usuario nuevo intenta reservar
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "quiero reservar cita",
  "session_id": "nuevo-usuario-session",
  "correo_electronico": "nuevousuario@test.com",
  "nombre": "Carlos Nuevo",
  "telefono": "987654321"
}

### 15.2. Usuario nuevo solicita ver citas
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "ver mis citas",
  "session_id": "nuevo-usuario-session",
  "correo_electronico": "nuevousuario@test.com"
}

###############################################################################
# 16. M√öLTIPLES SESIONES SIMULT√ÅNEAS
###############################################################################

### 16.1. Sesi√≥n A - Usuario 1
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "Hola",
  "session_id": "session-A",
  "correo_electronico": "{{pacienteEmail}}"
}

### 16.2. Sesi√≥n B - Usuario 2
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "Buenos d√≠as",
  "session_id": "session-B",
  "correo_electronico": "paciente2@test.com"
}

### 16.3. Sesi√≥n A - Iniciar reserva
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "reservar cita",
  "session_id": "session-A",
  "correo_electronico": "{{pacienteEmail}}"
}

### 16.4. Sesi√≥n B - Ver citas
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "ver mis citas",
  "session_id": "session-B",
  "correo_electronico": "paciente2@test.com"
}

### 16.5. Verificar que las sesiones est√°n separadas
GET {{baseUrl}}/chatbot/historial/?session_id=session-A

### 16.6. Verificar sesi√≥n B
GET {{baseUrl}}/chatbot/historial/?session_id=session-B

###############################################################################
# 17. CONVERSACI√ìN LARGA Y CAMBIO DE CONTEXTO
###############################################################################

### 17.1. Conversaci√≥n compleja - Inicio
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "Hola",
  "session_id": "conversacion-larga",
  "correo_electronico": "{{pacienteEmail}}"
}

### 17.2. Pedir ayuda
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "ayuda",
  "session_id": "conversacion-larga",
  "correo_electronico": "{{pacienteEmail}}"
}

### 17.3. Ver citas
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "mostrar citas",
  "session_id": "conversacion-larga",
  "correo_electronico": "{{pacienteEmail}}"
}

### 17.4. Consultar horarios
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "horarios disponibles",
  "session_id": "conversacion-larga",
  "correo_electronico": "{{pacienteEmail}}"
}

### 17.5. Iniciar reserva
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "quiero agendar",
  "session_id": "conversacion-larga",
  "correo_electronico": "{{pacienteEmail}}"
}

### 17.6. Cambiar de opini√≥n y despedirse
POST {{baseUrl}}/chatbot/mensaje/
Content-Type: application/json

{
  "mensaje": "no, mejor otro d√≠a. Adi√≥s",
  "session_id": "conversacion-larga",
  "correo_electronico": "{{pacienteEmail}}"
}

###############################################################################
# 18. LOGOUT
###############################################################################

### 18.1. Logout Paciente
POST {{baseUrl}}/auth/logout/
Authorization: Token {{pacienteToken}}

###############################################################################
# ‚úÖ RESULTADO ESPERADO
###############################################################################
#
# ‚úÖ Bot responde a saludos correctamente
# ‚úÖ Bot proporciona ayuda cuando se solicita
# ‚úÖ Bot muestra citas existentes del paciente
# ‚úÖ Bot muestra horarios disponibles
# ‚úÖ Flujo de reserva multi-paso funciona (fecha ‚Üí horario ‚Üí tipo ‚Üí confirmar)
# ‚úÖ Bot entiende "ma√±ana", "pasado ma√±ana", DD/MM/YYYY
# ‚úÖ Bot permite cancelar reserva en progreso
# ‚úÖ Bot responde a despedidas
# ‚úÖ Historial de conversaci√≥n se guarda correctamente
# ‚úÖ Reset de contexto funciona
# ‚úÖ Edge cases manejados (mensajes vac√≠os, fechas inv√°lidas, horarios inexistentes)
# ‚úÖ Usuarios no registrados reciben mensaje apropiado
# ‚úÖ M√∫ltiples sesiones simult√°neas son independientes
# ‚úÖ Conversaciones largas mantienen contexto
# ‚úÖ Intent detection funciona para todos los casos
#
###############################################################################
